You are my Replit build agent. Upgrade the site to a fast PWA with offline support and instant updates. Use only vanilla HTML/CSS/JS. Create/overwrite these files exactly.

=====================
FILE: index.html
=====================
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SmartFlow AIbot-Social ‚Äî Grow Faster with Smarter Social</title>
  <meta name="description" content="AI social media manager for small businesses & entrepreneurs. Generate platform-native posts, schedule at best times, export CSV/ICS, and track what works."/>
  <meta name="theme-color" content="#0b0b0b"/>
  <link rel="icon" href="assets/favicon.svg"/>
  <link rel="manifest" href="manifest.webmanifest"/>

  <!-- iOS install hint -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Open Graph -->
  <meta property="og:title" content="SmartFlow AIbot-Social"/>
  <meta property="og:description" content="Post smarter. Grow faster. Sell more."/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="assets/og.png"/>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"SmartFlow AIbot-Social",
    "applicationCategory":"MarketingApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"19","priceCurrency":"GBP"},
    "publisher":{"@type":"Organization","name":"SmartFlow Systems"}
  }
  </script>

  <link rel="preload" href="styles.css" as="style">
  <link rel="stylesheet" href="styles.css">
  <script defer src="script.js"></script>
</head>
<body>
  <!-- Sticky Nav -->
  <header class="nav" role="banner">
    <a class="brand" href="#hero" aria-label="SmartFlow Systems">
      <img src="assets/favicon.svg" alt="" width="26" height="26" decoding="async"/>
      <span>SmartFlow Systems</span>
    </a>
    <nav class="links" role="navigation" aria-label="Primary">
      <a href="#how">How it works</a>
      <a href="#generator">Demo</a>
      <a href="#features">Features</a>
      <a href="#pricing">Pricing</a>
      <a href="#case">Case study</a>
      <a class="btn small glow" href="#cta">Try it free</a>
    </nav>
  </header>

  <!-- Hero -->
  <section id="hero" class="hero" aria-label="Hero">
    <canvas id="heroFx" aria-hidden="true"></canvas>
    <div class="hero-inner" data-animate>
      <h1><span class="gold">Your AI Social Media Manager</span> for real small-biz growth</h1>
      <p class="lede">Generate platform-native posts, schedule at the best time, and convert attention into bookings & sales ‚Äî all in one place.</p>
      <div class="hero-cta">
        <a class="btn primary glow" href="#generator">Generate your first post</a>
        <a class="btn ghost" href="#pricing">See pricing</a>
      </div>
      <div class="badges">
        <span data-animate>‚ö° Best-time scheduling</span>
        <span data-animate>üìä Hook & hashtag insights</span>
        <span data-animate>üß† Presets & tones per niche</span>
      </div>
    </div>
    <div class="noise" aria-hidden="true"></div>
  </section>

  <!-- How it Works -->
  <section id="how" class="how">
    <h2 data-animate>How it works</h2>
    <div class="steps">
      <div class="card" data-animate>
        <h3>1) Tell us your business</h3>
        <p>Retail, fitness, services, food, creators, ecom ‚Äî we adapt your voice instantly.</p>
      </div>
      <div class="card" data-animate>
        <h3>2) Generate & schedule</h3>
        <p>Hook ‚Üí benefit + proof ‚Üí CTA ‚Üí smart hashtags. Export CSV/ICS or plug into tools.</p>
      </div>
      <div class="card" data-animate>
        <h3>3) Grow faster</h3>
        <p>Post at the right time, learn what works, and turn views into customers.</p>
      </div>
    </div>
  </section>

  <!-- Generator -->
  <section id="generator" class="generator">
    <h2 data-animate>Live Demo ‚Äî Generate Posts</h2>
    <form id="gen-form" class="gen-form" autocomplete="off" data-animate>
      <div class="grid">
        <label>Business/Niche
          <input id="niche" placeholder="e.g. Coffee shop, fitness coach, electrician" />
        </label>
        <label>Offer / Angle
          <input id="offer" placeholder="e.g. New bundle, 10% off, free consult" />
        </label>
        <label>Tone
          <select id="tone" aria-label="Tone">
            <option value="helpful">Helpful</option>
            <option value="concise">Concise</option>
            <option value="friendly" selected>Friendly</option>
            <option value="bold">Bold</option>
          </select>
        </label>
        <label>Platform
          <select id="platform" aria-label="Platform">
            <option value="X">X (Twitter)</option>
            <option value="LinkedIn" selected>LinkedIn</option>
          </select>
        </label>
        <label>Audience
          <input id="audience" placeholder="e.g. busy parents, founders, new homeowners" />
        </label>
        <label>Count
          <input id="count" type="number" min="1" max="10" value="3"/>
        </label>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn primary glow">Generate</button>
        <button type="button" id="clear" class="btn ghost">Clear</button>
      </div>
    </form>

    <div class="best-time" data-animate>
      <h3>Recommended posting windows (your local time)</h3>
      <div class="time-grid">
        <div>
          <h4>X</h4>
          <ul id="times-x"></ul>
        </div>
        <div>
          <h4>LinkedIn</h4>
          <ul id="times-li"></ul>
        </div>
      </div>
      <p class="note">Defaults from benchmarks; Pro adapts to your audience automatically.</p>
    </div>

    <div id="outputs" class="outputs" aria-live="polite"></div>

    <div id="exports" class="exports hidden" data-animate>
      <button class="btn small glow" id="downloadCsv">Download CSV</button>
      <button class="btn small glow" id="downloadIcs">Download ICS</button>
    </div>
  </section>

  <!-- Features -->
  <section id="features" class="features">
    <h2 data-animate>What makes SmartFlow different</h2>
    <div class="grid-3">
      <div class="card" data-animate>
        <h3>Platform-native copy</h3>
        <p>Winning structure: hook ‚Üí benefit + proof ‚Üí CTA ‚Üí rotating hashtags.</p>
      </div>
      <div class="card" data-animate>
        <h3>Best-time scheduler</h3>
        <p>Start with proven windows, then learn from your data.</p>
      </div>
      <div class="card" data-animate>
        <h3>Exports that fit</h3>
        <p>One click to CSV for bulk tools and ICS for your calendar.</p>
      </div>
      <div class="card" data-animate>
        <h3>Voice presets</h3>
        <p>Helpful, concise, friendly, bold ‚Äî or blend your own tone.</p>
      </div>
      <div class="card" data-animate>
        <h3>Hashtag IQ</h3>
        <p>Rotates 3‚Äì6 relevant tags; track which ones move the needle.</p>
      </div>
      <div class="card" data-animate>
        <h3>Built for speed</h3>
        <p>Pure HTML/CSS/JS, instant loads, smooth motion ‚Äî no heavy frameworks.</p>
      </div>
    </div>
  </section>

  <!-- Pricing -->
  <section id="pricing" class="pricing">
    <h2 data-animate>Pricing</h2>
    <div class="price-grid">
      <div class="price-card" data-animate>
        <h3>Starter</h3>
        <p class="price">¬£19/mo</p>
        <ul>
          <li>30 posts / month</li>
          <li>1 platform</li>
          <li>Templates + schedule</li>
        </ul>
        <a class="btn" href="#cta">Start free</a>
      </div>
      <div class="price-card featured" data-animate>
        <div class="ribbon">Popular</div>
        <h3>Pro</h3>
        <p class="price">¬£49/mo</p>
        <ul>
          <li>90 posts / month</li>
          <li>2 platforms</li>
          <li>Smart Replies + Best-Time</li>
          <li>CSV/ICS export</li>
        </ul>
        <a class="btn primary glow" href="#cta">Get Pro</a>
      </div>
      <div class="price-card" data-animate>
        <h3>Premium</h3>
        <p class="price">¬£99/mo</p>
        <ul>
          <li>Unlimited drafts</li>
          <li>Bulk schedule + Experiments</li>
          <li>Team seats (2)</li>
          <li>Priority support</li>
        </ul>
        <a class="btn" href="#cta">Go Premium</a>
      </div>
    </div>
    <p class="note">Referral: 20% recurring for 12 months.</p>
  </section>

  <!-- Case Study -->
  <section id="case" class="case">
    <h2 data-animate>Mini Case Study</h2>
    <div class="case-wrap">
      <div class="case-copy" data-animate>
        <h3>Local shop ‚Üí +35% weekly sales in 3 weeks</h3>
        <ul>
          <li>Daily posts using helpful/friendly voice</li>
          <li>Re-posting winners at peak times</li>
          <li>Direct checkout links in CTA</li>
        </ul>
        <p><strong>Result:</strong> more footfall, more repeat customers, and steady follower growth.</p>
      </div>
      <div class="case-card" data-animate>
        <div class="case-metric"><span>+35%</span><small>Weekly sales</small></div>
        <div class="case-metric"><span>+43%</span><small>Profile visits</small></div>
        <div class="case-metric"><span>+28%</span><small>Engagement rate</small></div>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section id="cta" class="cta">
    <h2 data-animate>Ready to grow faster?</h2>
    <p data-animate>Try SmartFlow AIbot-Social free today. No commitment.</p>
    <a class="btn primary glow" href="#" onclick="alert('Demo CTA ‚Äî wire to signup or Stripe when ready.');return false;">Start free</a>
  </section>

  <!-- Update Toast (hidden by default) -->
  <div id="update-toast" class="toast" role="status" aria-live="polite" hidden>
    <span>Update ready</span>
    <button id="refresh-now" class="btn small glow">Refresh</button>
    <button id="dismiss-toast" class="btn small">Dismiss</button>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>¬© <span id="year"></span> SmartFlow Systems ‚Äî Black & Gold, Smooth & Futuristic.</p>
  </footer>
</body>
</html>

=====================
FILE: styles.css
=====================
:root{
  --bg:#0b0b0b; --panel:#111213; --muted:#9a9a9a; --gold:#d4af37; --gold-2:#f5d67b;
  --txt:#f2f2f2; --ok:#3ad29f; --shadow:0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;scroll-behavior:smooth}
a{color:inherit;text-decoration:none}
img{display:block;max-width:100%}
h1,h2,h3{letter-spacing:.2px}

.nav{
  position:sticky;top:0;z-index:60;display:flex;align-items:center;justify-content:space-between;
  padding:14px 20px;background:rgba(11,11,11,.7);backdrop-filter:saturate(1.1) blur(8px);border-bottom:1px solid #1a1a1a
}
.brand{display:flex;align-items:center;gap:10px;font-weight:800}
.links{display:flex;gap:16px;align-items:center}
.links a{opacity:.9}
.links .btn.small{padding:8px 12px}

.btn{
  display:inline-block;border:1px solid #2a2a2a;padding:12px 18px;border-radius:12px;transition:transform .18s ease, box-shadow .18s ease;box-shadow:var(--shadow)
}
.btn:hover{transform:translateY(-1px)}
.btn.primary{background:linear-gradient(135deg,var(--gold),var(--gold-2));color:#111;font-weight:900;border-color:transparent}
.btn.ghost{background:transparent}
.btn.small{padding:8px 12px;font-size:.9rem}
.glow{position:relative;isolation:isolate}
.glow::after{
  content:"";position:absolute;inset:-2px;border-radius:14px;pointer-events:none;opacity:.0;
  background:conic-gradient(from 0deg, rgba(245,214,123,.3), rgba(212,175,55,.1), transparent 30%, transparent 70%, rgba(212,175,55,.2));
  filter:blur(8px);transition:opacity .25s ease
}
.glow:hover::after{opacity:.9}

.hero{position:relative;min-height:74vh;padding:100px 20px 50px;overflow:hidden}
#heroFx{position:absolute;inset:0;width:100%;height:100%}
.hero-inner{max-width:1080px;margin:0 auto;text-align:center;position:relative;z-index:2}
.hero h1{font-size:2.6rem;margin:0 0 10px}
.gold{color:var(--gold)}
.lede{opacity:.9;max-width:820px;margin:0 auto 20px}
.hero-cta{display:flex;gap:12px;justify-content:center;margin:18px 0 8px}
.badges{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;opacity:.9}
.badges span{border:1px solid #242424;padding:6px 10px;border-radius:999px;background:#111}
.noise{position:absolute;inset:0;opacity:.12;pointer-events:none;background-image:url('assets/noise.png');mix-blend:overlay}

section{padding:60px 20px;scroll-margin-top:84px}
section h2{font-size:1.9rem;margin:0 0 18px;text-align:center}

.how .steps{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}
.card{background:var(--panel);border:1px solid #1f1f1f;padding:18px;border-radius:16px;box-shadow:var(--shadow)}

.generator{max-width:1080px;margin:0 auto}
.gen-form .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
.gen-form label{display:flex;flex-direction:column;gap:6px;font-size:.95rem}
.gen-form input,.gen-form select{background:#121212;border:1px solid #222;color:var(--txt);padding:12px;border-radius:10px}
.form-actions{display:flex;gap:10px;margin-top:12px}
.best-time{margin-top:24px}
.time-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
.time-grid ul{list-style:none;padding:0;margin:0}
.time-grid li{background:#111;border:1px solid #262626;padding:10px;border-radius:10px}

.outputs{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:22px}
.post{background:#101010;border:1px solid #222;border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px;box-shadow:var(--shadow)}
.post pre{white-space:pre-wrap;margin:0;font-family:ui-monospace, Menlo, Consolas, monospace}
.meta{display:flex;gap:10px;flex-wrap:wrap}
.meta .pill{background:#0f0f0f;border:1px solid #262626;padding:6px 10px;border-radius:999px;font-size:.85rem}
.actions{display:flex;gap:8px}

.features .grid-3{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}

.pricing .price-grid{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}
.price-card{background:#101010;border:1px solid #222;border-radius:16px;padding:20px;position:relative;transform:translateZ(0)}
.price-card .price{font-size:2rem;margin:.2rem 0 1rem;color:var(--gold)}
.price-card.featured{outline:2px solid var(--gold)}
.price-card:hover{box-shadow:0 0 0 1px rgba(212,175,55,.25), 0 12px 30px rgba(0,0,0,.45)}
.ribbon{position:absolute;top:12px;right:-16px;background:linear-gradient(135deg,var(--gold),var(--gold-2));color:#111;padding:6px 12px;border-radius:999px;font-weight:800}

.case .case-wrap{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:2fr 1fr;gap:16px}
.case-card{display:grid;gap:10px}
.case-metric{background:#121212;border:1px solid #242424;border-radius:12px;padding:16px;text-align:center}
.case-metric span{font-size:1.8rem;color:var(--ok);display:block}

.faq details{max-width:880px;margin:10px auto;background:#101010;border:1px solid #222;border-radius:12px;padding:14px}
.faq summary{cursor:pointer}

.cta{text-align:center;background:radial-gradient(800px 300px at 50% 0, rgba(212,175,55,.18), transparent 60%)}
.footer{padding:26px 20px;border-top:1px solid #1a1a1a;text-align:center;opacity:.8}

.reveal{opacity:0;transform:translateY(18px);transition:opacity .6s ease, transform .6s ease}
.reveal.in{opacity:1;transform:none}

/* Update toast */
.toast{
  position:fixed;left:50%;bottom:20px;transform:translateX(-50%);z-index:80;
  display:flex;gap:10px;align-items:center;
  background:#121212;border:1px solid #2a2a2a;border-radius:12px;padding:10px 12px;box-shadow:var(--shadow)
}
.toast[hidden]{display:none}

@media (max-width: 980px){
  .how .steps,.features .grid-3,.pricing .price-grid,.outputs,.gen-form .grid,.case .case-wrap,.time-grid{grid-template-columns:1fr}
  .hero h1{font-size:2.1rem}
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .glow::after{display:none}
  .reveal{transition:none}
}

=====================
FILE: script.js
=====================
// ---------- Helpers ----------
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));
const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));

// ---------- Year ----------
$('#year').textContent = new Date().getFullYear();

// ---------- Reveal on Scroll ----------
const revealEls = $$('[data-animate]');
revealEls.forEach(el=>el.classList.add('reveal'));
const io = new IntersectionObserver((entries)=>{
  for (const e of entries){
    if (e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); }
  }
},{threshold:.15});
revealEls.forEach(el=>io.observe(el));

// ---------- Hero Canvas FX ----------
const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
const canvas = $('#heroFx');
const ctx = canvas.getContext('2d', {alpha:true});
let w=0,h=0, time=0, mouseX=0, mouseY=0;
function size(){ w=canvas.width=canvas.clientWidth; h=canvas.height=canvas.clientHeight; }
function loop(){
  if (prefersReduced) return;
  time+=0.008; ctx.clearRect(0,0,w,h);
  const cx=w/2, cy=h*0.4;
  for(let i=0;i<12;i++){
    const ang = i*(Math.PI*2/12) + time;
    const len = h*0.9 + Math.sin(time*2+i)*20;
    const x2 = cx + Math.cos(ang)*(len + mouseX*0.03);
    const y2 = cy + Math.sin(ang)*(len + mouseY*0.03);
    const grad = ctx.createLinearGradient(cx,cy,x2,y2);
    grad.addColorStop(0,'rgba(245,214,123,0.08)');
    grad.addColorStop(1,'rgba(212,175,55,0)');
    ctx.strokeStyle = grad; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x2,y2); ctx.stroke();
  }
  requestAnimationFrame(loop);
}
function onMove(e){
  const r = canvas.getBoundingClientRect();
  mouseX = (e.clientX - r.left) - w/2;
  mouseY = (e.clientY - r.top) - h/2;
}
window.addEventListener('resize', size, {passive:true});
canvas.addEventListener('mousemove', onMove, {passive:true});
size(); requestAnimationFrame(loop);

// ---------- Best-time Suggestions ----------
function nextWindows(platform, count=6){
  const now = new Date();
  const slots = [];
  const addSlot = (d, h, m) => {
    const t = new Date(d); t.setHours(h,m,0,0);
    if (t > now) slots.push(t);
  };
  for (let i=0;i<14;i++){
    const d = new Date(); d.setDate(now.getDate()+i);
    const wd = d.getDay(); // 0 Sun ... 6 Sat
    if (platform === 'X'){
      [[7,30],[12,0],[17,0]].forEach(([h,m])=>addSlot(d,h,m));
      if (wd>=2 && wd<=4) addSlot(d,19,0);
    } else {
      addSlot(d,8,0); addSlot(d,9,0); addSlot(d,12,0); addSlot(d,13,0);
      if (wd===2 || wd===4) addSlot(d,10,0);
    }
  }
  return slots.slice(0,count);
}
function fmtTime(d){
  return new Intl.DateTimeFormat(undefined,{weekday:'short', hour:'2-digit', minute:'2-digit'}).format(d);
}
function renderTimes(){
  $('#times-x').innerHTML  = nextWindows('X',6).map(d=>`<li>${fmtTime(d)}</li>`).join('');
  $('#times-li').innerHTML = nextWindows('LinkedIn',6).map(d=>`<li>${fmtTime(d)}</li>`).join('');
}
renderTimes();

// ---------- Generator ----------
const hashtagSeeds = {
  generic: ['#SmallBusiness','#Entrepreneur','#LocalBusiness','#Growth','#Marketing','#AI'],
  retail: ['#ShopLocal','#RetailTips','#ProductLaunch','#Ecommerce'],
  services: ['#Trades','#HomeServices','#BookNow','#NearMe'],
  fitness: ['#FitnessBusiness','#Coaching','#GymOwner','#PT'],
  food: ['#FoodBusiness','#Cafe','#Coffee','#StreetFood'],
  creator: ['#CreatorEconomy','#ContentStrategy','#PersonalBrand']
};
function nicheKey(n=''){
  const s = n.toLowerCase();
  if (s.match(/retail|store|shop|boutique|ecom|e-commerce/)) return 'retail';
  if (s.match(/coach|fitness|gym|trainer|pt/)) return 'fitness';
  if (s.match(/restaurant|cafe|coffee|food|bar/)) return 'food';
  if (s.match(/plumber|electrician|builder|trades?|service/)) return 'services';
  if (s.match(/creator|influencer|personal brand/)) return 'creator';
  return 'generic';
}
function pickTags(niche, n=4){
  const pools = ['generic']; const key = nicheKey(niche); if (key!=='generic') pools.push(key);
  const bag = pools.flatMap(k=>hashtagSeeds[k]||[]); const uniq = Array.from(new Set(bag)); const out=[];
  while(out.length < Math.max(3, Math.min(n,6)) && uniq.length){ out.push(uniq.splice(Math.floor(Math.random()*uniq.length),1)[0]); }
  return out;
}
function capFirst(str){ return str.replace(/^\s*([a-z])/,(m,c)=>c.toUpperCase()); }
function makeHook(niche, offer, tone){
  const starts = {
    helpful:  ["Quick win for growth:", "Here‚Äôs a smarter move:", "Stop guessing your posts."],
    concise:  ["Heads up:", "Fast tip:", "Real talk:"],
    friendly: ["Hey team ‚Äî", "Small biz win:", "Let‚Äôs grow this week:"],
    bold:     ["Stop the scroll.", "Own your niche.", "This is how you win:"]
  }[tone] || ["Let‚Äôs grow:"];
  const s = starts[Math.floor(Math.random()*starts.length)];
  const nicheBit = niche ? ` ${niche.trim()}` : " your business";
  const offerBit = offer ? ` with ${offer.trim()}` : "";
  return `${s} ${capFirst(nicheBit)} can grow${offerBit}.`;
}
function makeBody(niche, offer){
  const benefit = [
    "Post smarter and reach more customers",
    "Turn views into bookings and sales",
    "Save time while staying consistent",
    "Stand out with clean, on-brand posts"
  ];
  const proof = [
    "Proven hooks + rotating hashtags",
    "Best-time scheduler built-in",
    "A/B your first line and keep the winner",
    "Export CSV/ICS to plug into your tools"
  ];
  const b = benefit[Math.floor(Math.random()*benefit.length)];
  const p = proof[Math.floor(Math.random()*proof.length)];
  const off = offer ? ` Offer: ${offer}.` : "";
  return `${b}. ${p}.${off}`;
}
function makeCTA(){
  const ct = [
    "Want a done-for-you first draft? Tap to try free.",
    "Ready to grow? Book a quick demo.",
    "Grab today‚Äôs best-time slot and post.",
    "Claim your Pro trial ‚Äî see the data."
  ];
  return ct[Math.floor(Math.random()*ct.length)];
}
function enforcePlatformLimits(text, platform){
  const limit = platform==='X' ? 280 : 1200;
  if (text.length<=limit) return text;
  const lines=text.split('\n'); let out='';
  for (const line of lines){ if ((out+'\n'+line).length>limit-3) break; out+=(out?'\n':'')+line; }
  return out.trim().slice(0,limit-1)+'‚Ä¶';
}
function postJSON({text, alt, imgHint, hashtags}){ return {text, alt_text:alt, suggested_image:imgHint, hashtags}; }
function makePosts({niche, offer, tone, platform, audience, count}){
  const posts=[];
  for (let i=0;i<count;i++){
    const hook=makeHook(niche,offer,tone);
    const body=makeBody(niche,offer);
    const cta=makeCTA();
    const tags=pickTags(niche,3+(i%4)); // 3‚Äì6
    let text=`${hook}\n\n${body}\n\n${cta}\n${tags.join(' ')}`;
    text=enforcePlatformLimits(text,platform);
    const alt="Minimal black & gold graphic with clean headline and subtle gradient frame.";
    const img="Dark brown/black background, shiny gold title text, subtle border ‚Äî SmartFlow Systems style.";
    posts.push(postJSON({text,alt,imgHint:img,hashtags:tags}));
  }
  return posts;
}
// Render posts
function escapeHtml(s){ return s.replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }
function escapeAttr(s){ return s.replace(/"/g,'&quot;'); }
function hookScore(text){
  const first = text.split('\n')[0]||''; let score=50 + Math.max(0, Math.min(30, 80-first.length)); if(/stop|win|grow|today|free|new/i.test(first)) score+=10;
  return Math.max(40, Math.min(95, Math.round(score)));
}
let lastGenerated = { posts: [], platform: 'LinkedIn' };
function renderPosts(posts, platform){
  const wrap = $('#outputs'); wrap.innerHTML='';
  posts.forEach(p=>{
    const pretty = JSON.stringify(p,null,2);
    const el=document.createElement('div'); el.className='post reveal in';
    el.innerHTML=`
      <div class="meta">
        <span class="pill">${platform}</span>
        <span class="pill">Hook score: ${hookScore(p.text)}</span>
        <span class="pill">Hashtags: ${p.hashtags.length}</span>
      </div>
      <pre>${escapeHtml(pretty)}</pre>
      <div class="actions">
        <button class="btn small glow" data-copy="${escapeAttr(p.text)}">Copy text</button>
        <button class="btn small glow" data-copy="${escapeAttr(p.hashtags.join(' '))}">Copy hashtags</button>
      </div>
    `;
    wrap.appendChild(el);
  });
  $('#exports').classList.toggle('hidden', posts.length===0);
  $$('#outputs .actions .btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const txt=btn.getAttribute('data-copy');
      navigator.clipboard.writeText(txt.replace(/&quot;/g,'"'));
      const prev=btn.textContent; btn.textContent='Copied!'; setTimeout(()=>btn.textContent=prev, 900);
    })
  });
}
// Exports
function download(filename, content, type='text/plain'){
  const blob=new Blob([content],{type}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=filename; a.click(); URL.revokeObjectURL(url);
}
function toCSV(posts, platform){
  const esc=v=>`"${String(v).replace(/"/g,'""')}"`;
  const rows=[['platform','text','hashtags','alt_text','suggested_image'].map(esc).join(',')];
  posts.forEach(p=>rows.push([platform,p.text,p.hashtags.join(' '),p.alt_text,p.suggested_image].map(esc).join(',')));
  return rows.join('\n');
}
function toICS(posts){
  const now=new Date(); const base=nextWindows('LinkedIn', posts.length);
  const lines=['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//SmartFlow Systems//AIbot Social//EN'];
  const fmt=d=>d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
  posts.forEach((p,i)=>{
    const start=base[i]||new Date(now.getTime()+ (i+1)*3600e3);
    const end=new Date(start.getTime()+30*60e3);
    lines.push('BEGIN:VEVENT',`UID:${Math.random().toString(36).slice(2)+Date.now().toString(36)}@sfs`,
      `DTSTAMP:${fmt(new Date())}`,`DTSTART:${fmt(start)}`,`DTEND:${fmt(end)}`,
      `SUMMARY:Post: ${p.text.slice(0,60)}`,`DESCRIPTION:${p.text.replace(/\n/g,'\\n')}`,'END:VEVENT');
  });
  lines.push('END:VCALENDAR'); return lines.join('\n');
}
// Form wiring
function restore(){
  try{
    const s=JSON.parse(localStorage.getItem('smartflow-settings')||'{}');
    if(s.niche) $('#niche').value=s.niche;
    if(s.offer) $('#offer').value=s.offer;
    if(s.tone) $('#tone').value=s.tone;
    if(s.platform) $('#platform').value=s.platform;
    if(s.audience) $('#audience').value=s.audience;
    if(s.count) $('#count').value=s.count;
  }catch(e){}
}
function save(state){ localStorage.setItem('smartflow-settings', JSON.stringify(state)); }
document.addEventListener('DOMContentLoaded', ()=>{
  restore();
  $('#gen-form').addEventListener('submit', (e)=>{
    e.preventDefault();
    const niche=$('#niche').value.trim();
    const offer=$('#offer').value.trim();
    const tone=$('#tone').value;
    const platform=$('#platform').value;
    const audience=$('#audience').value.trim();
    const count=Math.max(1, Math.min(parseInt($('#count').value||'3',10),10));
    const posts=makePosts({niche,offer,tone,platform,audience,count});
    lastGenerated={posts,platform};
    renderPosts(posts, platform);
    save({niche,offer,tone,platform,audience,count});
  });
  $('#clear').addEventListener('click', ()=>{ $('#outputs').innerHTML=''; $('#exports').classList.add('hidden'); });
  $('#downloadCsv').addEventListener('click', ()=>download('smartflow_posts.csv', toCSV(lastGenerated.posts,lastGenerated.platform), 'text/csv'));
  $('#downloadIcs').addEventListener('click', ()=>download('smartflow_schedule.ics', toICS(lastGenerated.posts), 'text/calendar'));
});

// ---------- Service Worker registration & Update Toast ----------
if ('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('sw.js').then(reg=>{
      // Update found
      reg.addEventListener('updatefound', ()=>{
        const nw = reg.installing;
        if (!nw) return;
        nw.addEventListener('statechange', ()=>{
          if (nw.state==='installed' && navigator.serviceWorker.controller){
            showUpdateToast(()=> nw.postMessage({type:'SKIP_WAITING'}));
          }
        });
      });
      // When controller changes (new SW active), refresh
      navigator.serviceWorker.addEventListener('controllerchange', ()=> window.location.reload());
    }).catch(console.error);
  });
}
function showUpdateToast(onRefresh){
  const toast = $('#update-toast');
  const btn = $('#refresh-now');
  const dismiss = $('#dismiss-toast');
  if (!toast) return;
  toast.hidden = false;
  btn.onclick = onRefresh;
  dismiss.onclick = ()=> toast.hidden = true;
}

=====================
FILE: sw.js
=====================
/* SmartFlow PWA Service Worker
   Strategy:
   - HTML navigations: network-first with cache fallback (and offline.html as last resort).
   - Static assets (CSS/JS/images): cache-first with background refresh (stale-while-revalidate-ish).
*/
const VERSION = 'sfs-v2025-08-17';
const ASSET_CACHE = `assets-${VERSION}`;
const PAGE_CACHE  = `pages-${VERSION}`;

const CORE_ASSETS = [
  './',
  'index.html',
  'styles.css',
  'script.js',
  'offline.html',
  'manifest.webmanifest',
  'assets/favicon.svg',
  'assets/noise.png',
  'assets/og.png'
];

self.addEventListener('install', (event)=>{
  event.waitUntil(
    caches.open(ASSET_CACHE).then(cache=>cache.addAll(CORE_ASSETS)).then(()=>self.skipWaiting())
  );
});

self.addEventListener('activate', (event)=>{
  event.waitUntil(
    caches.keys().then(keys=>{
      return Promise.all(keys.filter(k=>!k.includes(VERSION)).map(k=>caches.delete(k)));
    }).then(()=>self.clients.claim())
  );
});

// Listen for skip-waiting trigger from the page
self.addEventListener('message', (event)=>{
  if (event.data && event.data.type === 'SKIP_WAITING'){
    self.skipWaiting();
  }
});

self.addEventListener('fetch', (event)=>{
  const req = event.request;
  const url = new URL(req.url);

  // Handle navigation (HTML) requests
  if (req.mode === 'navigate'){
    event.respondWith(
      fetch(req).then(res=>{
        const copy = res.clone();
        caches.open(PAGE_CACHE).then(c=>c.put(req, copy));
        return res;
      }).catch(async ()=>{
        const cached = await caches.match(req);
        return cached || caches.match('offline.html');
      })
    );
    return;
  }

  // Static assets: cache-first, then update cache in background
  if (['style','script','image','font'].includes(req.destination)){
    event.respondWith((async ()=>{
      const cached = await caches.match(req);
      const fetchPromise = fetch(req).then(res=>{
        const copy = res.clone();
        caches.open(ASSET_CACHE).then(c=>c.put(req, copy));
        return res;
      }).catch(()=>null);
      return cached || fetchPromise || new Response('', {status: 504});
    })());
    return;
  }
});

=====================
FILE: offline.html
=====================
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Offline ‚Äî SmartFlow AIbot-Social</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    main{max-width:720px;margin:12vh auto;padding:24px;background:#101010;border:1px solid #222;border-radius:14px;text-align:center}
    p{opacity:.9}
  </style>
</head>
<body>
  <main>
    <h1 class="gold">You‚Äôre offline</h1>
    <p>This page is available without internet. When you‚Äôre back online, the app will sync and refresh automatically.</p>
    <p><a class="btn primary" href="./">Go back home</a></p>
  </main>
</body>
</html>

=====================
FILE: manifest.webmanifest
=====================
{
  "name": "SmartFlow AIbot-Social",
  "short_name": "SmartFlow",
  "start_url": "./",
  "display": "standalone",
  "background_color": "#0b0b0b",
  "theme_color": "#0b0b0b",
  "icons": [
    { "src": "assets/favicon.svg", "sizes": "any", "type": "image/svg+xml", "purpose": "any" }
  ]
}

=====================
FILE: assets/favicon.svg
=====================
<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 64 64">
  <defs>
    <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
      <stop offset="0" stop-color="#d4af37"/>
      <stop offset="1" stop-color="#f5d67b"/>
    </linearGradient>
  </defs>
  <rect x="0" y="0" width="64" height="64" rx="12" fill="#0b0b0b"/>
  <circle cx="32" cy="32" r="22" fill="none" stroke="url(#g)" stroke-width="3"/>
  <path d="M16 36 C24 44, 40 20, 48 28" fill="none" stroke="url(#g)" stroke-width="4" stroke-linecap="round"/>
  <text x="20" y="42" font-family="Arial, sans-serif" font-weight="700" font-size="12" fill="url(#g)">SFS</text>
</svg>

=====================
FILE: assets/noise.png
=====================
(placeholder tiny tile ‚Äî optional; keep file so SW can cache it)

=====================
FILE: assets/og.png
=====================
(placeholder 1200√ó630 image for social sharing)

=====================
FILE: README.md
=====================
# SmartFlow AIbot-Social ‚Äî PWA Edition
What‚Äôs new:
- ‚úÖ Installable PWA (manifest) with offline cache + instant updates
- ‚úÖ Network-first for HTML (fresh when online), cache fallback, offline page
- ‚úÖ Cache-first for static assets with background refresh
- ‚úÖ Update toast prompts users to refresh when a new version is ready

How to test:
1) Load the site once online (this seeds the cache).
2) Turn off your internet and refresh: you should see pages load from cache; navigations fall back to **offline.html**.
3) Deploy a change (version in sw.js updates). You‚Äôll see the ‚ÄúUpdate ready‚Äù toast; press **Refresh** to swap instantly.